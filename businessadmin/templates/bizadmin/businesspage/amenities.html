{% extends 'bizadmin/index.html' %}
{% load static %}
{% load hosts %}
{% load crispy_forms_tags %}
{% block bpageact%}active{%endblock%}
{% block businessadmin %}
<!-- Main page content-->
    <div class="content">
        <div class="row">
            <div class="col-md-12 ml-auto mr-auto">
                <header class="page-header page-header-compact page-header-light mb-2">
                    <div class="container-fluid">
                        <div class="page-header-content">
                            <div class="row align-items-center justify-content-between pt-3">
                                <div class="col-auto">
                                    <h1 class="page-header-title">
                                        Business Page - Amenities and tags
                                    </h1>
                                </div>
                            </div>
                        </div>
                    </div>
                </header>
                <!-- Account page navigation-->
                <nav class="nav nav-borders">
                    <a class="nav-link  ml-0" href="{% host_url 'photos' host 'bizadmin'%}">Photo and Gallery</a>
                    <a class="nav-link activate" href="{% host_url 'amenities' host 'bizadmin'%}">Amenities and Tags</a>
                </nav>
                <hr class="mt-0 mb-4" />
                <div class="row">
                    <div class="col-lg-6 mb-4">
                        <div class="card h-100 border-left-lg border-left-secondary">
                            <div class="card-header"><h4>Add The Amenities You Offer</h4> <small>Add some of the amenities you offer to your clients. Type up to 10 amenities in the input section then enter. (Each amenity can be up to 25 characters long)</small> </div>
                            <div class="card-body">
                                <!-- Gallary upload button -->
                                <form method="POST" enctype="multipart/form-data">
                                    {% csrf_token %}
                                    <div class="col-12">
                                        <input id="amenitiestag" type="text" size="20" value="{% for amenity in amenities %}{{ amenity.amenity }},{% endfor %}" class="tagsinput textarea form-control" data-role="tagsinput" data-color="danger">
                                    </div>
                                                                    
                                </form>
                            </div>
                        </div>
                    </div>
                    <div class="col-lg-6 mb-4">
                        <div class="card h-100 border-left-lg border-left-secondary">
                            <div class="card-header"><h4>Add Your Tags</h4> <small>This helps expand your reach so include up to 20 key words related to your business.</small> </div>
                            <div class="card-body">
                                <!-- Gallary upload button -->
                                <form method="POST" enctype="multipart/form-data">
                                    {% csrf_token %}
                                    <input id="taggerinput" size="20" type="text" value="{% for tags in company.tags.all %}{{ tags }},{% endfor %}" class="tagsinput textarea form-control" data-role="tagsinput" data-color="danger">                                
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script>
        function getCookie(name) {
        let cookieValue = null;
        if (document.cookie && document.cookie !== '') {
            const cookies = document.cookie.split(';');
            for (let i = 0; i < cookies.length; i++) {
                const cookie = cookies[i].trim();
                // Does this cookie string begin with the name we want?
                if (cookie.substring(0, name.length + 1) === (name + '=')) {
                    cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                    break;
                }
            }
        }
            return cookieValue;
        }

        $('#taggerinput').tagsinput({
            maxTags: 25,
            maxChars: 15,
            confirmKeys: [13, 188, 32]
        });

        $('#taggerinput').on('itemAdded', function(event){
            var tag = event.item;
            $.ajax({
                type:'POST',
                dataType: 'json',
                url: "{% host_url 'addtag' host 'bizadmin' %}",
                data: JSON.stringify({addedTag: tag}),
                headers:{
                    "X-CSRFToken": csrftoken
                },
                cache: false,
                success: function(data){
                    $.notify({
                    // options
                    message: 'Tag Added'
                    },{
                        // settings
                        type: 'success',
                        delay: 50,
                    });
                }
            });
        });
        $('#taggerinput').on('itemRemoved', function(event){
            var tag = event.item;
            $.ajax({
                type:'POST',
                dataType: 'json',
                url: "{% host_url 'removetag' host 'bizadmin' %}",
                data: JSON.stringify({removedTag: tag}),
                headers:{
                    "X-CSRFToken": csrftoken
                },
                cache: false,
                success: function(data){
                    $.notify({
                    // options
                    message: 'Tag Removed'
                    },{
                        // settings
                        type: 'success',
                        delay: 50,
                    });
                }
            });
        });

        $('#amenitiestag').tagsinput({
            maxTags: 10,
            maxChars: 25,
            confirmKeys: [13, 188],
        });
        $('#amenitiestag').on('itemAdded', function(event){
            var tag = event.item;
            $.ajax({
                type:'POST',
                dataType: 'json',
                url: "{% host_url 'addamenity' host 'bizadmin' %}",
                data: JSON.stringify({addedAmenity: tag}),
                headers:{
                    "X-CSRFToken": csrftoken
                },
                success: function(data){
                    $.notify({
                    // options
                    message: 'Amenity Added'
                    },{
                        // settings
                        type: 'success',
                        delay: 50,
                    });
                }
            });
        });
        $('#amenitiestag').on('itemRemoved', function(event){
            var tag = event.item;
            $.ajax({
                type:'POST',
                dataType: 'json',
                url: "{% host_url 'removeamenity' host 'bizadmin' %}",
                data: JSON.stringify({removedAmenity: tag}),
                headers:{
                    "X-CSRFToken": csrftoken
                },
                cache: false,
                success: function(data){
                    $.notify({
                    // options
                    message: 'Amenity Removed'
                    },{
                        // settings
                        type: 'success',
                        delay: 50,
                    });
                }
            });
        });
    </script>
{% endblock %}