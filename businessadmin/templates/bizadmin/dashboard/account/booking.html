{% extends 'bizadmin/index.html' %}
{% load static %}
{% load hosts %}
{% load crispy_forms_tags %}
{% block activedetails%}active{%endblock%}
{% block businessadmin %}

                    <!-- Main page content-->
                    <div class="content">
                        <div class="row">
                        <div class="col-md-12 ml-auto mr-auto">
                        <header class="page-header page-header-compact page-header-light mb-2">
                        <div class="container-fluid">
                            <div class="page-header-content">
                                <div class="row align-items-center justify-content-between pt-3">
                                    <div class="col-auto">
                                        <h1 class="page-header-title">
                                            Account Settings - Booking
                                        </h1>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </header>
                        <!-- Account page navigation-->
                        <nav class="nav nav-borders">
                            <a class="nav-link ml-0" href="{% host_url 'profile' host 'bizadmin'%}">Profile</a>
                            {% comment %} <a class="nav-link" href="{% host_url 'billing' host 'bizadmin'%}">Billing</a> {% endcomment %}
                            <a class="nav-link activate" href="{% host_url 'bookingSetting' host 'bizadmin' %}">Booking Settings</a>
                            <a class="nav-link" href="{% host_url 'security' host 'bizadmin'%}">Security</a>
                            <a class="nav-link" href="{% host_url 'notifications' host 'bizadmin'%}">Notifications</a>
                        </nav>
                        <hr class="mt-0 mb-4" />

                        <form id="intervalForm">
                        <div class="row">
                            <div class="col-lg-8">
                                <!-- Security preferences card-->
                                <div class="card mb-4">
                                    <div class="card-header"><h4>Main Booking Settings</h4></div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-6">
                                                    <label for="" class="font-weight-bold d-flex justify-content-center pr-1">Booking Interval <a data-toggle="tooltip" data-placement="top" title="Set the duration for appointment slots"> <i class="fas fa-question-circle licolor"></i></a></label>
                                                    {{ booking_form.interval|as_crispy_field }}
                                            </div>
                                            <div class="col-md-6">
                                                <label for="" class="font-weight-bold d-flex justify-content-center pr-1">Cancellation Policy <a data-toggle="tooltip" data-placement="top" title="The length of time before an appointment which a customer can cancel"> <i class="fas fa-question-circle licolor"></i></a></label>
                                                {{ booking_form.cancellation|as_crispy_field }}
                                            </div>
                                            <div class="col-md-6 text-left">
                                                <label for="" class="font-weight-bold d-flex justify-content-left pr-1">Advanced Notice Time<a data-toggle="tooltip" data-placement="top" title="The time required in advance prior to setting an appointment"> <i class="fas fa-question-circle licolor"></i></a></label>
                                                <div class="row">
                                                    <div class="col-4 pr-0">
                                                        {{ booking_form.before_window_day|as_crispy_field }}
                                                    </div>
                                                    <div class="col-4 px-0">
                                                        {{ booking_form.before_window_hour|as_crispy_field }}
                                                    </div>
                                                    <div class="col-4 pl-0">
                                                        {{ booking_form.before_window_min|as_crispy_field }}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-md-6 text-left">
                                                <label for="" class="font-weight-bold d-flex justify-content-left pr-1">Scheduling Window<a data-toggle="tooltip" data-placement="top" title="How far in advance are clients allowed to book a service?"> <i class="fas fa-question-circle licolor"></i></a></label>
                                                <div class="row">
                                                    <div class="col-6 pr-0">
                                                        {{ booking_form.after_window_month|as_crispy_field }}
                                                    </div>
                                                    <div class="col-6 pl-0">
                                                        {{ booking_form.after_window_day|as_crispy_field }}
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="col-lg-4">
                                <div class="card mb-4">
                                    <div class="card-header"><h4>Booking Options</h4></div>
                                    <div class="card-body text-center">
                                        <form>
                                            <label for="" class="font-weight-bold d-flex justify-content-center pr-1">Returning Clients Only<a data-toggle="tooltip" data-placement="top" title="Only accept clients who are on your client list"> <i class="fas fa-question-circle licolor"></i></a></label>
                                            <div class="custom-control custom-radio">
                                                <input class="custom-control-input" id="radioReturning" type="radio" name="radioPrivacy" {% if company.returning %}checked{% endif %} />
                                                <label class="custom-control-label" name="radReturning" for="radioReturning">Returning Clients Only</label>
                                            </div>
                                            <div class="custom-control custom-radio">
                                                <input class="custom-control-input" id="radioOpen" type="radio" name="radioPrivacy" {% if company.returning == False %}checked{% endif %} />
                                                <label class="custom-control-label" name="radPrivate" for="radioOpen">Open for everyone to book</label>
                                            </div>
                                        </form>
                                    </div>
                                </div>
                            </div>
                        </div>
                        </form>
                    </div>
                    </div>
                        </div>
                    </div>
{% endblock %}
{% block java %}
    <script>
        $(document).ready(function(){
            var selectInterval = document.getElementById("id_interval");
            var selectCancellation = document.getElementById('id_cancellation');
            var before_window_day = document.getElementById('id_before_window_day');
            var before_window_hour = document.getElementById('id_before_window_hour');
            var before_window_min = document.getElementById('id_before_window_min');
            var after_window_month = document.getElementById('id_after_window_month');
            var after_window_day = document.getElementById('id_after_window_day');
            function getCookie(name) {
            let cookieValue = null;
            if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
                return cookieValue;
            }
            const csrftoken = getCookie('csrftoken');

            selectInterval.addEventListener('change',function(e){
                const interval = e.target.value
                $.ajax({
                    url: '{% host_url "bookingIntervalAPI" host "bizadmin" %}',
                    data: $('#intervalForm').serialize(),
                    type: "POST",
                    dataType: 'json',
                    headers:{
                        "X-CSRFToken": csrftoken
                    },
                    success: function(){
                        $.notify({
                            // options
                            message: 'We successfully updated your booking interval'
                        },{
                            // settings
                            type: 'success'
                        });
                    },
                });
            });

            selectCancellation.addEventListener('change',function(e){
                const cancellation = e.target.value
                $.ajax({
                    url: '{% host_url "bookingIntervalAPI" host "bizadmin" %}',
                    data: $('#intervalForm').serialize(),
                    type: "POST",
                    dataType: 'json',
                    headers:{
                        "X-CSRFToken": csrftoken
                    },
                    success: function(){
                        $.notify({
                            // options
                            message: 'We successfully updated your cancellation policy'
                        },{
                            // settings
                            type: 'success'
                        });
                    },
                });
            });

            before_window_day.addEventListener('change',function(e){
                const cancellation = e.target.value
                $.ajax({
                    url: '{% host_url "bookingIntervalAPI" host "bizadmin" %}',
                    data: $('#intervalForm').serialize(),
                    type: "POST",
                    dataType: 'json',
                    headers:{
                        "X-CSRFToken": csrftoken
                    },
                    success: function(){
                        $.notify({
                            // options
                            message: 'We have updated your Notice Time Window'
                        },{
                            // settings
                            type: 'success'
                        });
                    },
                });
            });

            before_window_hour.addEventListener('change',function(e){
                const cancellation = e.target.value
                $.ajax({
                    url: '{% host_url "bookingIntervalAPI" host "bizadmin" %}',
                    data: $('#intervalForm').serialize(),
                    type: "POST",
                    dataType: 'json',
                    headers:{
                        "X-CSRFToken": csrftoken
                    },
                    success: function(){
                        $.notify({
                            // options
                            message: 'We have updated your Notice Time'
                        },{
                            // settings
                            type: 'success'
                        });
                    },
                });
            });

            before_window_min.addEventListener('change',function(e){
                const cancellation = e.target.value
                $.ajax({
                    url: '{% host_url "bookingIntervalAPI" host "bizadmin" %}',
                    data: $('#intervalForm').serialize(),
                    type: "POST",
                    dataType: 'json',
                    headers:{
                        "X-CSRFToken": csrftoken
                    },
                    success: function(){
                        $.notify({
                            // options
                            message: 'We have updated your Notice Time'
                        },{
                            // settings
                            type: 'success'
                        });
                    },
                });
            });

            after_window_month.addEventListener('change',function(e){
                const cancellation = e.target.value
                $.ajax({
                    url: '{% host_url "bookingIntervalAPI" host "bizadmin" %}',
                    data: $('#intervalForm').serialize(),
                    type: "POST",
                    dataType: 'json',
                    headers:{
                        "X-CSRFToken": csrftoken
                    },
                    success: function(){
                        $.notify({
                            // options
                            message: 'We have updated your Scheduling Window'
                        },{
                            // settings
                            type: 'success'
                        });
                    },
                });
            });

            after_window_day.addEventListener('change',function(e){
                const cancellation = e.target.value
                $.ajax({
                    url: '{% host_url "bookingIntervalAPI" host "bizadmin" %}',
                    data: $('#intervalForm').serialize(),
                    type: "POST",
                    dataType: 'json',
                    headers:{
                        "X-CSRFToken": csrftoken
                    },
                    success: function(){
                        $.notify({
                            // options
                            message: 'We have updated your Scheduling Window'
                        },{
                            // settings
                            type: 'success'
                        });
                    },
                });
            });

            $('#radioReturning').on('click', function(){
                $.ajax({
                    url: '{% host_url "bookingReturningAPI" host "bizadmin" %}',
                    data: JSON.stringify({returning:true}),
                    type: "POST",
                    dataType: 'json',
                    headers:{
                        "X-CSRFToken": csrftoken
                    },
                    success: function(){
                        Swal.fire({
                            title: 'We successfully updated your returning clients option',
                            icon:'success',
                            customClass:{
                                confirmButton: 'btn btn-primary',
                                cancelButton: 'btn btn-danger',
                            },
                        buttonsStyling: false,
                        });
                    },
                });
            });
            $('#radioOpen').on('click', function(){
                $.ajax({
                    url: '{% host_url "bookingReturningAPI" host "bizadmin" %}',
                    data: JSON.stringify({returning:false}),
                    type: "POST",
                    dataType: 'json',
                    headers:{
                        "X-CSRFToken": csrftoken
                    },
                    success: function(){
                        Swal.fire({
                            title: 'We successfully updated your returning clients option',
                            icon:'success',
                            customClass:{
                                confirmButton: 'btn btn-primary',
                                cancelButton: 'btn btn-danger',
                            },
                        buttonsStyling: false,
                        });
                    },
                });
            });

        });
    </script>
{% endblock java %}