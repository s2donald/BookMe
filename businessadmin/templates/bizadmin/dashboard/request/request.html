{% extends 'bizadmin/index.html' %}
{% load static %}
{% load crispy_forms_tags %}
{% load hosts %}
{% block linescript %}
{% endblock linescript %}
{% block bizrequests %}active{%endblock%}
{% block businessadmin %}
                    
                    <!-- Main page content-->
                    <div class="content">
                        <div class="row">
                        <div class="col-md-10 ml-auto mr-auto">
                        <header class="page-header page-header-compact page-header-light mb-4">
                        <div class="container">
                            <div class="page-header-content">
                                <div class="row align-items-center justify-content-between pt-3">
                                    <div class="col-auto mb-3">
                                        <h1 class="page-header-title">
                                            Company Reviews
                                        </h1>
                                    </div>
                                </div>
                            </div>
                        </div>
                        </header>
                        <hr class="mt-0 mb-4" />
                        <div class="row">
                            <div class="col-xl-12">
                                <!-- Account details card-->
                                <div class="card mb-4">
                                    <div class="card-header">All requests and updates</div>
                                    <div class="card-body" id="service-t">
                                            {% for req in requested %}
                                                <div class="card">
                                                    <div class="row">
                                                        <div class="col-12">
                                                            {% with user=req.user  %}
                                                            <div class="card-body d-lg-flex justify-content-between text-center">
                                                                <div class="row">
                                                                    <div class="col-sm-12 d-flex pull-right">
                                                                        <p class="subtitle text-left mr-3"><strong class="text-danger">{{user.first_name}} {{ user.last_name }} </strong>{% if req.add_to_list %}wants to be added to your client list.{% endif %}</p>
                                                                    </div>
                                                                    <div>
                                                                        <p class='subtitle text-left mr-3'>Contact Info:</p>
                                                                    </div>
                                                                        <p class="text-left text-info">Email: {{ user.email }}, Phone:{{ user.phone }}</p>
                                                                    </div>
                                                            </div>

                                                                    <button type="button" class="btn btn-primary btn-sm accept" data-url="{% host_url 'addRequested' req.id host 'bizadmin' %}">Accept Request</button>
                                                                    <button type="button" class="btn btn-danger btn-sm decline" data-url="{% host_url 'deleteRequested' req.id host 'bizadmin' %}">Decline Request</button>
                                                            {% endwith %}
                                                        </div>
                                                    </div>
                                                </div>
                                            {% empty %}
                                                <div class="card">
                                                    <div class="card-header">You have no requests yet.</div>
                                                </div>
                                            {% endfor %}
                                            {% include 'bizadmin/dashboard/reviews/pagination.html' with page=requested%}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
    <script>
        $(document).ready(function(){
            function getCookie(name) {
                let cookieValue = null;
                if (document.cookie && document.cookie !== '') {
                const cookies = document.cookie.split(';');
                for (let i = 0; i < cookies.length; i++) {
                    const cookie = cookies[i].trim();
                    // Does this cookie string begin with the name we want?
                    if (cookie.substring(0, name.length + 1) === (name + '=')) {
                        cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                        break;
                    }
                }
            }
            return cookieValue;
        }
        const csrftoken = getCookie('csrftoken');

            $('.accept').click(function(e){
                var $this = $(this)
                var urldata = $this.attr("data-url")
                $.ajax({
                    url: urldata,
                    type: 'post',
                    headers:{
                        "X-CSRFToken": csrftoken
                    },
                success: function(data){
                    Swal.fire({
                        title: data.added,
                        icon: 'success',
                        customClass:{
                                confirmButton: 'btn btn-primary',
                                cancelButton: 'btn btn-danger',
                            },
                        buttonsStyling: false,
                        
                    });
                },
                })
            })

            $('.decline').click(function(e){
                var $this = $(this)
                var urldata = $this.attr("data-url")
                $.ajax({
                    url: urldata,
                    type: 'post',
                    headers:{
                        "X-CSRFToken": csrftoken
                    },
                success: function(data){
                    Swal.fire({
                        title: data.deleted,
                        icon: 'success',
                        customClass:{
                                confirmButton: 'btn btn-primary',
                                cancelButton: 'btn btn-danger',
                            },
                        buttonsStyling: false,
                        
                    });
                },
                })
            })
        });
    </script>
{% endblock %}