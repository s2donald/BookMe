{% extends 'bizadmin/index.html' %}
{% load static %}
{% load hosts %}
{% block linkscript %}
    <link rel="stylesheet" href="{% static "css/calendarmain.css"%}">
    <script src="{% static "js/calendarmain.js" %}"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@10"></script>
{% endblock linkscript %}
{% block activecal%}active{%endblock%}
{% block businessadmin %}

<script>
    $('.datetimepicker').datetimepicker({
        format: 'LT',
        icons: {
        time: "fas fa-clock",
        up: "fa fa-chevron-up",
        down: "fa fa-chevron-down",
        previous: 'tim-icons icon-minimal-left',
        next: 'tim-icons icon-minimal-right',
        today: 'fa fa-screenshot',
        clear: 'fa fa-trash',
        close: 'fa fa-remove'
        }
    });
        document.addEventListener('DOMContentLoaded', function(){
                function gcd (a, b) {
                    return (b == 0) ? a : gcd (b, a%b);
                }
                var w = screen.width;
                var h = screen.height;
                var r = gcd (w, h);
                var aspect = (w/r)/(h/r)/0.8

                var leftitems = 'prev,next today'
                var rightitems = 'listWeek,listDay'
                var initviewcal = 'listDay'

                

                var asprat = aspect
                var calendarEl = document.getElementById('calendar');
                var calendar = new FullCalendar.Calendar(calendarEl, {
                    
                    buttonText: {
                        listWeek: 'Week',
                        listDay: 'Day',
                    },
                    selectable: true,
                aspectRatio: asprat,
                events:[
                {% for booking in bookings %}
                    {
                        title: 'Service:{{ booking.service.name }} ||| Client: {{ booking.user.first_name}}',
                        description: '{{ booking.user.firstname }}',
                        start: '{{ booking.start|date:"Y-m-d" }}'+'T'+'{{ booking.start|date:"H:i:s" }}',
                        end: '{{ booking.end|date:"Y-m-d" }}'+'T'+'{{ booking.end|date:"H:i:s" }}',
                        id: '{{ booking.id }}',
                        {% if forloop.counter|divisibleby:"2" %}
                            className: 'event-green',
                        {% elif forloop.counter|divisibleby:"3" %}
                            className: 'event-orange',
                        {% else %}
                            className:'event-red',
                        {% endif %}
                    },
                {% endfor %}
                ],
                eventClick: function(info) {

                    $.ajax({
                        type: 'GET',
                        url: '{% host_url "getBookingId" host "bizadmin" %}',
                        data:{booking_id:info.event.id},
                        async:false,
                        success: function(data){
                            var name ='S'
                            Swal.fire({

                                title: info.event.description,
                                html: data.html_string,
                                showCancelButton: true,
                                showDenyButton: true,
                                customClass:{
                                    confirmButton: 'btn btn-primary',
                                    cancelButton: 'btn btn-danger',
                                    denyButton: 'btn btn-danger',
                                },
                                confirmButtonText: `Change Booking Date`,
                                denyButtonText: `Delete Booking`,
                                cancelButtonText: 'Go Back',
                                buttonsStyling: false,
                            });
                        },
                    })
                },
                noEventsClassNames: 'No bookings to display',
                initialView: initviewcal,
                headerToolbar: {
                    center: rightitems,
                    left: 'title',
                    right: leftitems
                },navLinks: true,
                navLinkDayClick: function(date, jsEvent) {
                    //When you click the day
                }
            });
            calendar.render()
        });
        
        $('body').on('click', 'button.fc-prev-button', function() {
            
        });
    </script>
        <!-- Main page content-->
        <div class="content">
        <div class="row">
        <div class="col-md-12 ml-auto mr-auto">
            <div class="card mx-auto">
            <div class="card-header">Schedule Manager</div>
            <div class="card-body">
                <button class="btn btn-primary" id="addbooking">Add A Booking</button>
            </div>

            <div class="card-body">

                <p>If you want to reschedule or delete a booking, go into the Agenda below, navigate to the date of the booking and click on the booking. </p>
            </div>
                
            </div>
        </div>
          <div class="col-md-12 ml-auto mr-auto">
            <div class="card card-calendar">
            <div class="card-header"></div>
              <div class="card-body">
                <div id="calendar"></div>
              </div>
            </div>
          </div>
        </div>
      </div>
      <script>
        $(document).ready(function(e){
            $('#addbooking').on('click', function(){
                Swal.fire({
                    title: 'Add a booking',
                    html: `<p>Hello</p>`,

                }).then(function(e){
                    
                });
            });
        });
      </script>
{% endblock %}